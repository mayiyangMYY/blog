---
title: 网络流基础
mathjax: true
date: 2021-12-29 20:39:02
tags:
    - algorithm
    - flow
categories:
    - algorithm
    - flow
    - basic
top:
---

## **相关概念**
$V$ 表示所有结点的集合
$E$ 表示所有边的集合
$G=(V,E)$ ,表示整个图
$s$ 表示源点，$t$ 表示汇点
每条边 $(u,v)$ ,有容量 $c(u,v)$($c(u,v)\geq0$),流量 $f(u,v)$
$c(u,v)=0$ 则表示$(u,v)$不在网络中
**三个性质**
1. **容量限制** $f(u,v)\leq c(u,v)$
2. **反对称性** $f(u,v)=-f(v,u)$
3. **流量平衡** $\sum_{u\in V} f(v,u)=0$

## **最大流**
**流量**: $|f|=\sum_{v\in V}f(s,v)$

**最大流**: 在满足网络流三条性质时，$|f|$的最大值

**残量网络**(也就是一条弧还能有多少流量经过

**残量网络** $G_f$(如果网络中一条边 $cap = 0$，认为不在残量网络中)  

**残量网络边集** $E_f$

**后向弧**(实现时常用$i \oplus 1$):使得操作可以反悔

**增广路**: 在残量网络中一条s通往t的路径，其中任意一条弧都有 $r(u,v)>0$

**增广路算法**: 每次找一条最短的增广路径，然后沿着路径修改流量，无增广路时，流为最大流。

下面把 $f,r,c$ 的定义域扩展为点集 $f(X,Y)=\sum_{x\in X} \sum_{y\in Y} f(x,y) $

## **割**

**定义**: $S+T=V,s\in S,t\in T$

**注意**: 使用割做题时，不要认为 $S$ 或 $T$ 需要联通。

**一些结论**
1. 
> $f(X,X)=0$
$f(X,Y) = -f(Y,X)$
$F(X \bigcup Y,Z)=f(X,Z)+f(Y,Z)$
$F(X,Y \bigcup Z)=F(X,Y)+F(X,Z)$

2. 不包含s和t的点集,与它相关联的边上的流量值和为 0
> $f(X,V)=\sum_{x\in X}(\sum_{v\in V} f(x,v))=\sum_{x\in X}0 = 0$

3. **任何割的流量等于整个网络的流量**
> $f(S,T)=f(S,V)-f(S,S)=f(s,V)+f(S-s,V)=|f|$

4. 任何割的容量大于等于整个网络的流量 $|f| \leq c(S,T)$
> $f(S,T)=\sum_{x\in S}\sum_{y\in T} f(x,y) \leq\sum_{x\in S}\sum_{y\in T} c(x,y)=c(S,T)$

**最小割**: 所有可能的割中，容量最小的割
**最大流最小割定理**:
对于一个网络流图 $G=(V,E)$，其中有源点 $s$ 和汇点 $t$，下面三个条件是等价的：
1. 流 $f$ 是图 $G$ 的最大流
2. 残量网络不存在增广路
3. 对于 $G$ 的某一个割 $(S,T)$，此时 $f = C(S,T)$

$1 \rightarrow 2$: 根据网络流算法过程易得。

$3 \rightarrow 1$: 由上述结论 $4$ ，任何总流量不超过最小割容量，$f$ 必为最大流。

$2 \rightarrow 3$: **残量网络不存在增广路**，定义 $S$ 为当前残量网络中 $s$ 能够到达的点，$T = V - S$ 。$(S, T)$ 显然为割。

$\forall u \in S,v \in T$，有 $f(u,v)=c(u,v)$ 。所以 $f(S,T)=\sum f(u,v)=\sum c(u,v)=C(S,T)$ 。

## **最小费用最大流**
## **无源汇上下界可行流**
可行流：满足上下界和流量守恒
**核心思路: 在可行流上增流调整**。
建图，源点为 $S$ ，汇点为 $T$ 。
对于原图中每条边 $u\rightarrow v$，新图建 $u \rightarrow v$ 流量为 $high - low$。
记 $$g(x) = \sum_{to_i = x} low_i - \sum_{from_i = x} low_i$$
$g(x) > 0$ 时，$S \rightarrow x$ 流量 $g(x)$；
$g(x) < 0$ 时，$x \rightarrow T$ 流量 $-g(x)$。
新连的**附加边全部流满**才为可行

## **有源汇上下界可行流**
思想同上，只是还要 $T \rightarrow S$ 上下界 $[0, +\infty]$ 的边。

## **有源汇上下界最大流**
1. 先跑出可行流，摘除 $T \rightarrow S$ 的边，此时满足有源汇流量守恒。
2. 残量网络上跑出最大流，与附加流合并即可求得。

## **有源汇上下界最小流**
1. 先跑出可行流，摘除 $T \rightarrow S$ 的边，此时满足有源汇流量守恒。
2. 在附加流的基础上，减去 $dinic(T, S)$ 的结果。本质上是退流。

## **有源汇上下界最小费用可行流**
建图方式与有源汇上下界可行流基本相同，只是原始边加上费用。